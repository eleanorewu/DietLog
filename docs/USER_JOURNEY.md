# ä½¿ç”¨è€…æ—…ç¨‹å„ªåŒ–èªªæ˜

## æ¦‚è¿°

å„ªåŒ–å¾Œçš„ä½¿ç”¨è€…æ—…ç¨‹ç¢ºä¿æ–°ä½¿ç”¨è€…åœ¨ç™»å…¥/è¨»å†Šå¾Œå¿…é ˆå®Œæˆ Onboarding å¡«å¯«åŸºæœ¬è³‡æ–™ï¼Œè¨­å®šç›®æ¨™å¾Œæ‰èƒ½é€²å…¥ä¸»é é¢ã€‚åŒæ™‚åœ¨è¨­å®šé é¢æä¾›æ¸…æ¥šçš„å¸³è™Ÿè³‡è¨Šå’Œç™»å‡ºåŠŸèƒ½ã€‚

## å®Œæ•´ä½¿ç”¨è€…æ—…ç¨‹

### 1. åˆæ¬¡ä½¿ç”¨ (æ–°ç”¨æˆ¶)

```
è¼‰å…¥ç•«é¢ â†’ èªè­‰é é¢ â†’ è¨»å†ŠæˆåŠŸ â†’ Onboarding â†’ ä¸»é é¢
```

**æµç¨‹èªªæ˜ï¼š**

1. **è¼‰å…¥ç•«é¢**ï¼šæ‡‰ç”¨ç¨‹å¼å•Ÿå‹•ï¼Œæª¢æŸ¥ Firebase èªè­‰ç‹€æ…‹
2. **èªè­‰é é¢**ï¼š
   - ä½¿ç”¨è€…è¼¸å…¥ Email å’Œå¯†ç¢¼
   - ç³»çµ±å…ˆå˜—è©¦ç™»å…¥
   - å¦‚æœæ‰¾ä¸åˆ°ä½¿ç”¨è€…ï¼Œè‡ªå‹•åŸ·è¡Œè¨»å†Š
   - ä¹Ÿå¯ä»¥ä½¿ç”¨ Google ç™»å…¥
3. **Onboarding**ï¼š
   - å¡«å¯«å§“åã€æ€§åˆ¥ã€å¹´é½¡
   - è¼¸å…¥èº«é«˜ã€é«”é‡
   - é¸æ“‡æ´»å‹•é‡ç­‰ç´š
   - è¨­å®šç›®æ¨™ï¼ˆæ¸›é‡/ç¶­æŒ/å¢è‚Œï¼‰
   - è¨­å®šç›®æ¨™é«”é‡å’Œæ¯é€±æ¸›é‡é‡
   - ç³»çµ±è‡ªå‹•è¨ˆç®— BMRã€TDEEã€ç›®æ¨™ç†±é‡å’Œä¸‰å¤§ç‡Ÿé¤Šç´ 
4. **ä¸»é é¢**ï¼šå®Œæˆè¨­å®šå¾Œé€²å…¥ Dashboardï¼Œé–‹å§‹ä½¿ç”¨æ‡‰ç”¨ç¨‹å¼

### 2. å†æ¬¡ç™»å…¥ (èˆŠç”¨æˆ¶ - å·²å®Œæˆ Onboarding)

```
è¼‰å…¥ç•«é¢ â†’ æª¢æŸ¥èªè­‰ â†’ æª¢æŸ¥ Profile â†’ ä¸»é é¢
```

**æµç¨‹èªªæ˜ï¼š**

1. **è¼‰å…¥ç•«é¢**ï¼šæª¢æŸ¥ Firebase èªè­‰ç‹€æ…‹
2. **è‡ªå‹•æª¢æŸ¥**ï¼š
   - å·²ç™»å…¥ Firebase âœ“
   - LocalStorage æœ‰å€‹äººæª”æ¡ˆ âœ“
3. **ç›´æ¥é€²å…¥ä¸»é é¢**ï¼šç„¡éœ€å†æ¬¡å¡«å¯«è³‡æ–™

### 3. å†æ¬¡ç™»å…¥ (èˆŠç”¨æˆ¶ - æœªå®Œæˆ Onboarding)

```
è¼‰å…¥ç•«é¢ â†’ æª¢æŸ¥èªè­‰ â†’ æ²’æœ‰ Profile â†’ Onboarding â†’ ä¸»é é¢
```

**æµç¨‹èªªæ˜ï¼š**

1. **è¼‰å…¥ç•«é¢**ï¼šæª¢æŸ¥ Firebase èªè­‰ç‹€æ…‹
2. **è‡ªå‹•æª¢æŸ¥**ï¼š
   - å·²ç™»å…¥ Firebase âœ“
   - LocalStorage æ²’æœ‰å€‹äººæª”æ¡ˆ âœ—
3. **å°å‘ Onboarding**ï¼šå¼•å°ä½¿ç”¨è€…å®ŒæˆåŸºæœ¬è³‡æ–™è¨­å®š
4. **ä¸»é é¢**ï¼šå®Œæˆå¾Œé€²å…¥ Dashboard

### 4. ç™»å‡ºæµç¨‹

```
è¨­å®šé é¢ â†’ é»æ“Šç™»å‡º â†’ æ¸…é™¤è³‡æ–™ â†’ èªè­‰é é¢
```

**æµç¨‹èªªæ˜ï¼š**

1. **è¨­å®šé é¢**ï¼š
   - æŸ¥çœ‹ã€Œæˆ‘çš„å¸³è™Ÿã€å€å¡Š
   - é¡¯ç¤ºé›»å­éƒµä»¶å’Œå¸³è™Ÿåç¨±
   - é»æ“Šã€Œç™»å‡ºã€æŒ‰éˆ•
2. **æ¸…é™¤è³‡æ–™**ï¼š
   - ç™»å‡º Firebase èªè­‰
   - æ¸…é™¤ LocalStorage å€‹äººæª”æ¡ˆ
   - æ¸…é™¤é£²é£Ÿè¨˜éŒ„
   - æ¸…é™¤é«”é‡è¨˜éŒ„
3. **è¿”å›èªè­‰é é¢**ï¼šå¯é‡æ–°ç™»å…¥æˆ–è¨»å†Š

## æ ¸å¿ƒé‚è¼¯ (App.tsx)

### èªè­‰ç‹€æ…‹ç®¡ç†

```typescript
useEffect(() => {
  if (authLoading) return; // ç­‰å¾…èªè­‰ç‹€æ…‹è¼‰å…¥

  if (!firebaseUser) {
    // æœªç™»å…¥ï¼šé¡¯ç¤ºç™»å…¥é é¢
    navigateTo("login");
  } else if (!user) {
    // å·²ç™»å…¥ä½†æ²’æœ‰å€‹äººæª”æ¡ˆï¼šé¡¯ç¤º Onboarding
    navigateTo("onboarding");
  } else {
    // å·²ç™»å…¥ä¸”æœ‰å€‹äººæª”æ¡ˆï¼šé¡¯ç¤º Dashboard
    if (view === "login" || view === "onboarding") {
      navigateTo("dashboard");
    }
  }
}, [firebaseUser, authLoading, user]);
```

### é—œéµåˆ¤æ–·é»

1. **`authLoading === true`**: é¡¯ç¤ºè¼‰å…¥ç•«é¢
2. **`firebaseUser === null`**: æœªç™»å…¥ â†’ é¡¯ç¤ºèªè­‰é é¢
3. **`firebaseUser !== null && user === null`**: å·²ç™»å…¥ä½†æ²’æœ‰ profile â†’ é¡¯ç¤º Onboarding
4. **`firebaseUser !== null && user !== null`**: å·²ç™»å…¥ä¸”æœ‰ profile â†’ é¡¯ç¤ºä¸»é é¢

## è¨­å®šé é¢æ”¹é€²

### æ–°å¢ã€Œæˆ‘çš„å¸³è™Ÿã€å€å¡Š

```tsx
<div className="bg-white dark:bg-gray-800 p-4 rounded-xl border...">
  <h3>æˆ‘çš„å¸³è™Ÿ</h3>
  <div>
    <span>é›»å­éƒµä»¶</span>
    <span>{firebaseUser?.email || "æœªè¨­å®š"}</span>
  </div>
  <div>
    <span>å¸³è™Ÿåç¨±</span>
    <span>{firebaseUser?.displayName || user.name}</span>
  </div>

  <button onClick={handleLogout}>
    <LogOut /> ç™»å‡º
  </button>
</div>
```

### å€å¡Šé †åº

1. ä¸»é¡Œåˆ‡æ›
2. **æˆ‘çš„å¸³è™Ÿ** (æ–°å¢)
3. æˆ‘çš„å€‹äººæª”æ¡ˆ
4. ç†±é‡è¿½è¹¤
5. é«”é‡è¿½è¹¤
6. é‡ç½®æ‰€æœ‰è³‡æ–™

## å„ªåŒ–æ•ˆæœ

### âœ… è§£æ±ºçš„å•é¡Œ

1. **ç™»å…¥å¾Œç›´æ¥é€²ä¸»é **ï¼šç¾åœ¨æœƒå…ˆæª¢æŸ¥æ˜¯å¦å®Œæˆ Onboarding
2. **ç¼ºå°‘å¸³è™Ÿè³‡è¨Š**ï¼šè¨­å®šé é¢ç¾åœ¨é¡¯ç¤º Email å’Œå¸³è™Ÿåç¨±
3. **ç¼ºå°‘ç™»å‡ºåŠŸèƒ½**ï¼šåœ¨ã€Œæˆ‘çš„å¸³è™Ÿã€å€å¡Šæä¾›æ˜ç¢ºçš„ç™»å‡ºæŒ‰éˆ•
4. **ä½¿ç”¨è€…æ—…ç¨‹ä¸æ¸…æ™°**ï¼šå»ºç«‹æ¸…æ¥šçš„æµç¨‹é‚è¼¯

### ğŸ¯ ä½¿ç”¨è€…é«”é©—æ”¹å–„

1. **æ–°ä½¿ç”¨è€…**ï¼šè¨»å†Šå¾Œå¿…é ˆå®Œæˆ Onboardingï¼Œç¢ºä¿è³‡æ–™å®Œæ•´
2. **èˆŠä½¿ç”¨è€…**ï¼šç™»å…¥å¾Œç›´æ¥é€²å…¥ä¸»é ï¼Œç„¡éœ€é‡æ–°è¨­å®š
3. **å¸³è™Ÿç®¡ç†**ï¼šæ¸…æ¥šé¡¯ç¤ºå¸³è™Ÿè³‡è¨Šï¼Œæ–¹ä¾¿ç™»å‡º
4. **é‚è¼¯ä¸€è‡´**ï¼šæ‰€æœ‰èªè­‰ç›¸é—œé‚è¼¯çµ±ä¸€ç”± App.tsx ç®¡ç†

## æŠ€è¡“ç´°ç¯€

### AuthPage.tsx ç°¡åŒ–

- ç§»é™¤ `onAuthSuccess` prop
- ç™»å…¥/è¨»å†ŠæˆåŠŸå¾Œä¸åšå°èˆª
- è®“ App.tsx çš„ `useEffect` è‡ªå‹•è™•ç†å°èˆªé‚è¼¯

### App.tsx å¢å¼·

- åœ¨ `useEffect` ä¸­çµ±ä¸€ç®¡ç†èªè­‰ç‹€æ…‹
- ä¸‰å±¤æª¢æŸ¥ï¼šauthLoading â†’ firebaseUser â†’ user
- è¨­å®šé é¢æ–°å¢ã€Œæˆ‘çš„å¸³è™Ÿã€å€å¡Š
- é¡¯ç¤º Firebase ä½¿ç”¨è€…è³‡è¨Šï¼ˆemail, displayNameï¼‰

### è³‡æ–™æµ

```
Firebase Auth (firebaseUser)
    â†“
LocalStorage (UserProfile)
    â†“
UI Components (Dashboard, Settings, etc.)
```

## æœªä¾†æ“´å±•

### Firestore æ•´åˆå¾Œ

ç•¶æ•´åˆ Firestore å¾Œï¼Œä½¿ç”¨è€…è³‡æ–™æµå°‡è®Šç‚ºï¼š

```
Firebase Auth â†’ Firestore User Document â†’ UI Components
```

éœ€è¦èª¿æ•´ï¼š

1. `useUserProfile` hook æ”¹ç‚ºå¾ Firestore è®€å–
2. Onboarding å®Œæˆå¾Œå¯«å…¥ Firestore
3. ç™»å‡ºæ™‚åªéœ€æ¸…é™¤ Firebase Authï¼ˆFirestore è³‡æ–™ä¿ç•™ï¼‰

### å¯èƒ½çš„æ”¹é€²

1. **å¿˜è¨˜å¯†ç¢¼åŠŸèƒ½**ï¼šåœ¨èªè­‰é é¢æ·»åŠ é‡è¨­å¯†ç¢¼é€£çµ
2. **ç¤¾äº¤ç™»å…¥**ï¼šæ”¯æ´æ›´å¤šç¬¬ä¸‰æ–¹ç™»å…¥ï¼ˆFacebook, Appleï¼‰
3. **Email é©—è­‰**ï¼šè¦æ±‚ä½¿ç”¨è€…é©—è­‰ Email å¾Œæ‰èƒ½ä½¿ç”¨
4. **å€‹äººè³‡æ–™ç·¨è¼¯**ï¼šå…è¨±åœ¨è¨­å®šé é¢æ›´æ”¹ Email æˆ–å¯†ç¢¼

---

æ›´æ–°æ—¥æœŸï¼š2025 å¹´ 12 æœˆ 4 æ—¥
ç‰ˆæœ¬ï¼šv1.3
