# DietLog 產品規格書

## 1. 產品概述

### 1.1 產品名稱
DietLog - 飲食控制紀錄 PWA  
http://dietlog-pwa.vercel.app

### 1.2 產品定位
一款輕量級的漸進式網頁應用程式（PWA），專為需要管理飲食與體重的使用者設計。提供簡潔直觀的介面，讓使用者能輕鬆記錄每日飲食、追蹤營養攝取、監控體重變化，並根據個人化目標調整飲食計畫。

### 1.3 目標使用者
- 需要紀錄飲食的使用者
- 需要量身定制飲食建議的使用者
- 注重營養均衡的健康管理者

### 1.4 核心價值
- **簡單易用**：直觀的操作介面，快速記錄飲食
- **個人化**：根據使用者身體數據計算專屬營養目標
- **視覺化追蹤**：圖表呈現攝取狀況與體重變化趨勢
- **隨時隨地**：PWA 技術支援離線使用與安裝到裝置

---

## 2. 技術架構

### 2.1 技術棧
- **前端框架**：React 19.2.0
- **建構工具**：Vite 6.2.0
- **程式語言**：TypeScript 5.8.2
- **圖表庫**：Recharts 3.5.0
- **icon庫**：Lucide React 0.554.0
- **PWA 支援**：vite-plugin-pwa 1.1.0
- **圖片處理**：browser-image-compression 2.0.2

### 2.2 應用架構
- **單頁應用程式（SPA）**
- **本地儲存（LocalStorage）**：資料儲存於瀏覽器本地
- **響應式設計**：適配桌面與行動裝置
- **離線優先**：支援 PWA 離線功能

### 2.3 儲存架構
使用 LocalStorage 儲存三組主要資料：
- `dietlog_user_v1`：使用者個人檔案
- `dietlog_logs_v1`：飲食記錄
- `dietlog_weight_records_v1`：體重記錄

---

## 3. 功能規格

### 3.1 使用者引導（Onboarding）

#### 3.1.1 功能描述
初次使用時，引導使用者建立個人化檔案，分為 5 個步驟。

#### 3.1.2 步驟流程

**步驟 1：基本資訊**
- 名字（必填）
- 性別：生理男 / 生理女
- 年齡（必填）

**步驟 2：身體數據**
- 身高（cm，必填，支援小數點後兩位）
- 體重（kg，必填，支援小數點後兩位）
- 即時顯示 BMI 值與健康狀態分類

**步驟 3：活動量等級**
- 久坐（辦公室工作）
- 輕度活動（每週運動 1-2 天）
- 中度活動（每週運動 3-5 天）
- 高度活動（每天運動）
- 超高度活動（每天高強度運動或體力工作）

**步驟 4：目標選擇**
- 減重
- 維持體重
- 增肌

**步驟 5：目標設定**
- 目標體重（kg，必填）
- 預計每週減重（kg/週，必填）
- 顯示預估達成時間（週數）

#### 3.1.3 計算邏輯
- **BMR（基礎代謝率）**：使用 Mifflin-St Jeor 公式
  - 男性：`10 × 體重 + 6.25 × 身高 - 5 × 年齡 + 5`
  - 女性：`10 × 體重 + 6.25 × 身高 - 5 × 年齡 - 161`
- **TDEE（每日總消耗）**：`BMR × 活動係數`
  - 久坐：1.2
  - 輕度活動：1.375
  - 中度活動：1.55
  - 高度活動：1.725
  - 超高度活動：1.9
- **目標熱量**：
  - 減重：`TDEE - 500 kcal`
  - 維持：`TDEE`
  - 增肌：`TDEE + 300 kcal`
- **巨量營養素分配**：
  - 減重/增肌：蛋白質 40% / 碳水 35% / 脂肪 25%
  - 維持：蛋白質 20% / 碳水 50% / 脂肪 30%

#### 3.1.4 驗證規則
- 名字不可為空
- 年齡必須為正整數
- 身高、體重、目標體重、每週減重必須為正數
- 數值欄位支援最多兩位小數

---

### 3.2 主控面板（Dashboard）

#### 3.2.1 功能描述
顯示使用者每日飲食攝取概況、營養素達成狀況與飲食記錄。

#### 3.2.2 介面元件

**頂部導航**
- 日期選擇器（週曆檢視）
- 設定按鈕
- 日曆按鈕（切換至月曆檢視）

**週曆檢視**
- 顯示本週七天（一到日）
- 每日顯示日期與星期
- 有記錄的日期顯示圓點標記
- 選中日期高亮顯示
- 今日日期特殊標記
- 未來日期灰階顯示且不可選
- 前後週切換按鈕

**每日攝取概況**
- **已攝取**：當日總熱量
- **每日目標**：使用者目標熱量
- **TDEE**：使用者總消耗熱量
- **環形進度圖**：
  - 綠色：未超標
  - 紅色：已超標
  - 中心顯示剩餘或超標熱量

**巨量營養素追蹤**
- 蛋白質、碳水、脂肪
- 進度條顯示攝取比例
- 當前值 / 目標值（g）
- 超標時顯示警示圖示與紅色標記

**餐別分類**
- 早餐、午餐、晚餐、點心
- 每個餐別顯示總熱量
- 食物清單：
  - 食物圖片（若有）
  - 食物名稱
  - 熱量、蛋白質、碳水、脂肪
- 滑動刪除功能（行動裝置）
- 懸停顯示刪除按鈕（桌面裝置）
- 新增按鈕（每個餐別底部）

**未來日期鎖定**
- 顯示鎖定圖示與提示訊息
- 禁止新增或編輯記錄

#### 3.2.3 互動行為
- 點擊日期切換查看該日記錄
- 點擊食物項目進入編輯模式
- 滑動或點擊刪除按鈕刪除記錄（需確認）
- 點擊「新增」按鈕新增飲食記錄

---

### 3.3 飲食記錄（Food Entry）

#### 3.3.1 功能描述
新增或編輯單筆飲食記錄，包含圖片、名稱、餐別與營養資訊。

#### 3.3.2 介面元件

**頂部導航**
- 返回按鈕
- 標題（新增紀錄 / 編輯紀錄）
- 刪除按鈕（編輯模式且非未來日期）

**圖片上傳區**
- 點擊上傳圖片
- 支援圖片壓縮（最大 1MB，最大寬高 1920px）
- 預覽已上傳圖片
- 更換圖片按鈕（右下角浮動按鈕）

**表單欄位**
- **食物名稱**：文字輸入，預設「未知名稱」
- **餐別選擇**：早餐 / 午餐 / 晚餐 / 點心
- **營養成分**：
  - 熱量（kcal）
  - 蛋白質（g）
  - 碳水（g）
  - 脂肪（g）

**底部按鈕**
- 儲存紀錄 / 更新紀錄
- 未來日期時禁用且顯示提示

#### 3.3.3 互動行為
- 圖片壓縮過程顯示載入動畫
- 數值欄位僅接受數字與小數點
- 無效輸入時顯示錯誤提示（3 秒後自動消失）
- 刪除操作需二次確認

#### 3.3.4 資料結構
```typescript
interface FoodLog {
  id: string;
  date: string; // YYYY-MM-DD
  timestamp: number;
  mealType: 'breakfast' | 'lunch' | 'dinner' | 'snack';
  name: string;
  photoUrl?: string;
  calories: number;
  protein: number;
  fat: number;
  carbs: number;
}
```

---

### 3.4 月曆檢視（Month Calendar View）

#### 3.4.1 功能描述
以月為單位檢視飲食記錄狀況，快速跳轉至特定日期。

#### 3.4.2 介面元件
- 月份切換按鈕（上一月 / 下一月）
- 日期格線（7 列 × 最多 6 行）
- 有記錄的日期顯示綠色圓點
- 選中日期高亮顯示
- 未來日期灰階顯示且不可選
- 關閉按鈕返回主控面板

#### 3.4.3 互動行為
- 點擊日期選擇該日並返回主控面板
- 未來日期不可點擊

---

### 3.5 設定頁面（Settings）

#### 3.5.1 功能描述
檢視與編輯使用者個人檔案、查看熱量與體重追蹤資訊。

#### 3.5.2 介面元件

**頂部導航**
- 返回按鈕
- 標題：設定

**個人檔案區塊**
- 顯示：年齡、身高、體重、活動量等級、目標、目標體重、每週減重
- 編輯按鈕（進入編輯個人檔案頁面）

**熱量追蹤區塊**
- 7 天熱量趨勢折線圖
- X 軸：日期
- Y 軸：熱量值
- 參考線：每日目標熱量（綠色虛線）

**體重追蹤區塊**
- 當前體重顯示與編輯功能
- 減重進度資訊：
  - 還需減重（kg）
  - 預估達成時間（週）
- 體重趨勢折線圖
- 參考線：目標體重（綠色虛線）
- 查看體重資料列表按鈕

**重置按鈕**
- 刪除所有資料並回到引導頁面
- 需二次確認

#### 3.5.3 互動行為
- 點擊編輯按鈕修改體重（自動新增體重記錄）
- 點擊列表按鈕進入體重資料列表

---

### 3.6 編輯個人檔案（Edit Profile）

#### 3.6.1 功能描述
修改使用者個人資料，重新計算營養目標。

#### 3.6.2 介面元件
- 與引導流程相同的表單欄位
- 預填現有資料
- 儲存按鈕
- 取消按鈕

#### 3.6.3 互動行為
- 修改資料後自動重新計算 TDEE、目標熱量與巨量營養素
- 儲存後返回設定頁面

---

### 3.7 體重資料列表（Weight Data List）

#### 3.7.1 功能描述
檢視所有體重記錄，支援刪除功能。

#### 3.7.2 介面元件
- 返回按鈕
- 標題：體重記錄
- 記錄清單：
  - 日期
  - 體重值
  - 刪除按鈕

#### 3.7.3 互動行為
- 滑動或點擊刪除按鈕刪除記錄（需確認）
- 最新記錄排在最上方

#### 3.7.4 資料結構
```typescript
interface WeightRecord {
  id: string;
  date: string; // YYYY-MM-DD
  timestamp: number;
  weight: number; // kg
  note?: string;
}
```

---

### 3.8 熱量追蹤（Calorie Tracking）

#### 3.8.1 功能描述
在設定頁面顯示 7 天熱量攝取趨勢圖表。

#### 3.8.2 圖表規格
- **類型**：折線圖
- **資料範圍**：最近 7 天
- **X 軸**：日期（月/日格式）
- **Y 軸**：熱量值（kcal）
- **參考線**：目標熱量（綠色虛線）
- **資料點**：綠色圓點
- **趨勢線**：綠色實線

#### 3.8.3 互動行為
- 滑鼠懸停顯示當日詳細數值
- 響應式調整圖表大小

---

## 4. UI/UX 設計規範

### 4.1 設計風格
- **簡約現代**：扁平化設計，減少視覺干擾
- **綠色系主題**：代表健康與活力
- **卡片式佈局**：清晰分隔不同功能區塊

### 4.2 色彩系統
- **主色調**：Emerald 500 (#10B981) - 按鈕、進度條、高亮
- **輔助色**：
  - Slate 50-900 - 背景、文字、邊框
  - Red 500 (#EF4444) - 超標警示、刪除按鈕
  - Blue 500 (#3B82F6) - 資訊提示
  - Amber 600 (#D97706) - 警告提示
- **背景色**：Gray 100 (#F3F4F6)

### 4.3 字體系統
- **標題**：粗體（Font Weight 700-800）
- **正文**：中等（Font Weight 400-500）
- **數據**：粗體（Font Weight 600-700）
- **尺寸**：
  - 特大標題：2xl (24px)
  - 大標題：xl (20px)
  - 中標題：lg (18px)
  - 正文：sm-base (14-16px)
  - 小字：xs (12px)

### 4.4 間距系統
- 基於 Tailwind CSS 間距系統（0.25rem 倍數）
- 卡片內邊距：16-24px
- 元素間距：8-16px

### 4.5 響應式設計
- **行動優先**：預設為手機尺寸（375×667px）
- **桌面模式**：
  - 固定寬度容器（375px）
  - 固定高度（667px）
  - 圓角陰影效果模擬手機介面
- **平板模式**：介於行動與桌面之間

### 4.6 動畫與過渡
- **淡入動畫**：頁面切換（fadeIn）
- **滑入動畫**：側邊欄、彈窗（slideIn）
- **進度條動畫**：平滑過渡（transition-all duration-300）
- **按鈕回饋**：點擊縮放（active:scale-[0.98]）

---

## 5. 資料管理

### 5.1 資料儲存
- **技術**：LocalStorage API
- **容量限制**：約 5-10 MB（依瀏覽器而異）
- **資料持久化**：關閉瀏覽器後資料仍保留

### 5.2 資料同步
- 所有資料變更即時儲存至 LocalStorage
- 使用 `useEffect` 監聽狀態變化自動儲存

### 5.3 資料遷移
- 版本化儲存鍵（如 `_v1`）
- 載入時檢查並補充新增欄位預設值
- 向後相容舊版本資料

### 5.4 資料備份與重置
- 支援完整重置功能（清除所有 LocalStorage 資料）
- 無自動備份功能（未來可擴充雲端同步）

---

## 6. 進階功能

### 6.1 日期管理
- **時區處理**：使用台灣時區（Asia/Taipei）
- **日期格式**：YYYY-MM-DD
- **未來日期限制**：無法新增或編輯未來日期的記錄

### 6.2 圖片處理
- **壓縮演算法**：browser-image-compression
- **壓縮設定**：
  - 最大檔案大小：1 MB
  - 最大寬高：1920px
  - 輸出格式：JPEG
  - 使用 Web Worker 提升效能
- **儲存方式**：Base64 編碼儲存於 LocalStorage

### 6.3 滑動互動（Swipeable Item）
- **技術**：Touch Events API
- **功能**：向左滑動顯示刪除按鈕
- **平台適配**：僅在行動裝置啟用，桌面使用懸停顯示

### 6.4 對話框（Dialog）
- **功能**：二次確認操作（刪除、重置）
- **類型**：
  - 一般確認
  - 危險操作（紅色確認按鈕）
- **互動**：點擊遮罩或取消按鈕關閉

---

## 7. PWA 特性

### 7.1 Manifest 設定
```json
{
  "name": "DietLog",
  "short_name": "DietLog",
  "description": "輕鬆記錄每日飲食，管理健康生活。",
  "start_url": "/",
  "display": "standalone",
  "background_color": "#ffffff",
  "theme_color": "#10b981",
  "icons": [
    { "src": "/icons/icon-192.png", "sizes": "192x192" },
    { "src": "/icons/icon-512.png", "sizes": "512x512" }
  ]
}
```

### 7.2 離線支援
- Service Worker 快取靜態資源
- 應用程式外殼快取策略
- 離線時仍可訪問已載入頁面

### 7.3 安裝提示
- 支援「新增至主畫面」功能
- 獨立視窗模式（standalone）

---

## 8. 效能優化

### 8.1 載入優化
- Vite 快速建構與熱更新
- 程式碼分割（Code Splitting）
- 圖片壓縮減少儲存空間

### 8.2 渲染優化
- React 19 自動批次更新
- 避免不必要的重新渲染（useMemo、useCallback）
- 虛擬滾動（未來可擴充）

### 8.3 資料優化
- LocalStorage 讀寫最小化
- 批次更新避免頻繁儲存

---

## 9. 無障礙設計（Accessibility）

### 9.1 鍵盤導航
- 支援 Tab 鍵切換焦點
- Enter 鍵確認操作
- Escape 鍵取消操作

### 9.2 語意化 HTML
- 使用適當的標籤（button、input、label）
- 提供 aria-label 與 title 屬性

### 9.3 對比度
- 符合 WCAG AA 標準
- 文字與背景對比度足夠

---

## 10. 安全性

### 10.1 資料隱私
- 所有資料儲存於使用者本地
- 無伺服器端資料收集
- 無需註冊或登入

### 10.2 輸入驗證
- 前端驗證所有表單輸入
- 防止無效數據寫入

---

## 11. 測試策略

### 11.1 功能測試
- 使用者引導流程完整性
- 飲食記錄新增、編輯、刪除
- 日期切換與篩選
- 圖表資料正確性

### 11.2 跨瀏覽器測試
- Chrome、Firefox、Safari、Edge
- iOS Safari、Android Chrome

### 11.3 響應式測試
- 不同螢幕尺寸適配
- 觸控與滑鼠操作

---

## 12. 未來擴充方向

### 12.1 雲端同步
- 使用者帳號系統
- 跨裝置資料同步
- 資料備份與恢復

### 12.2 AI 營養辨識
- 整合 Gemini API
- 圖片辨識食物與營養成分
- 自動填寫營養資訊

### 12.3 社群功能
- 分享飲食記錄
- 好友互動與挑戰
- 健康食譜推薦

### 12.4 進階分析
- 長期趨勢分析
- 營養均衡評分
- 健康建議推送

### 12.5 整合其他健康資料
- 運動記錄
- 睡眠追蹤
- 水分攝取

---

## 13. 版本資訊

### 當前版本：v1.2

**主要功能**
- ✅ 使用者引導與個人檔案建立
- ✅ 飲食記錄新增、編輯、刪除
- ✅ 每日營養追蹤與視覺化
- ✅ 體重記錄與趨勢圖
- ✅ 月曆與週曆檢視
- ✅ 圖片上傳與壓縮
- ✅ PWA 支援與離線功能
- ✅ 響應式設計

**已知限制**
- 僅支援本地資料儲存
- 無雲端同步功能
- 無 AI 自動辨識食物

---

## 14. 開發與部署

### 14.1 開發環境
- Node.js（建議 v18 以上）
- npm 或 yarn

### 14.2 開發指令
```bash
# 安裝依賴
npm install

# 開發模式
npm run dev

# 建構生產版本
npm run build

# 預覽生產版本
npm run preview
```

### 14.3 部署
- **平台**：Vercel
- **網址**：http://dietlog-pwa.vercel.app
- **自動部署**：推送至主分支自動觸發

---

## 15. 聯絡資訊

**專案名稱**：DietLog  
**Repository**：eleanorewu/DietLog  
**主要分支**：main  
**授權**：私有專案  

---

## 附錄 A：資料結構完整定義

### UserProfile
```typescript
interface UserProfile {
  name: string;
  gender: 'male' | 'female';
  age: number;
  height: number; // cm
  weight: number; // kg
  activityLevel: 'sedentary' | 'light' | 'moderate' | 'active' | 'veryActive';
  goal: 'lose' | 'maintain' | 'gain';
  targetWeight: number; // kg
  weeklyWeightLoss: number; // kg/week
  tdee: number;
  targetCalories: number;
  targetProtein: number;
  targetFat: number;
  targetCarbs: number;
}
```

### FoodLog
```typescript
interface FoodLog {
  id: string;
  date: string; // YYYY-MM-DD
  timestamp: number;
  mealType: 'breakfast' | 'lunch' | 'dinner' | 'snack';
  name: string;
  photoUrl?: string;
  calories: number;
  protein: number;
  fat: number;
  carbs: number;
}
```

### WeightRecord
```typescript
interface WeightRecord {
  id: string;
  date: string; // YYYY-MM-DD
  timestamp: number;
  weight: number; // kg
  note?: string;
}
```

---

## 附錄 B：計算公式彙整

### BMI 計算
```
BMI = 體重(kg) ÷ (身高(m))²
```

### BMR 計算（Mifflin-St Jeor 公式）
```
男性：10 × 體重 + 6.25 × 身高 - 5 × 年齡 + 5
女性：10 × 體重 + 6.25 × 身高 - 5 × 年齡 - 161
```

### TDEE 計算
```
TDEE = BMR × 活動係數
```

### 目標熱量
```
減重：TDEE - 500 kcal
維持：TDEE
增肌：TDEE + 300 kcal
```

### 巨量營養素分配
**減重/增肌模式**
- 蛋白質：目標熱量 × 40% ÷ 4 (g)
- 碳水：目標熱量 × 35% ÷ 4 (g)
- 脂肪：目標熱量 × 25% ÷ 9 (g)

**維持模式**
- 蛋白質：目標熱量 × 20% ÷ 4 (g)
- 碳水：目標熱量 × 50% ÷ 4 (g)
- 脂肪：目標熱量 × 30% ÷ 9 (g)

---

*此規格書最後更新日期：2025年12月1日*
